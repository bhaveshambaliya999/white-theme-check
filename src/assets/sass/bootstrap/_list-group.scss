@use "variables" as variables;
@use "sass:color";
@use "sass:map";
@use "sass:math";
@use "sass:meta";
@use "functions";
@use "mixins/border-radius";
@use "mixins/breakpoints";
@use "mixins/list-group";

// Base list group
.list-group {
  display: flex;
  flex-direction: column;
  padding-left: 0; // reset ul/ol default
  margin-bottom: 0;
  @include border-radius.border-radius(variables.$list-group-border-radius);
}

.list-group-numbered {
  list-style-type: none;
  counter-reset: section;

  > li::before {
    content: counters(section, ".") ". ";
    counter-increment: section;
  }
}

// Interactive list items
.list-group-item-action {
  width: 100%;
  color: variables.$list-group-action-color;
  text-align: inherit;

  &:hover,
  &:focus {
    z-index: 1;
    color: variables.$list-group-action-hover-color;
    text-decoration: none;
    background-color: variables.$list-group-hover-bg;
  }

  &:active {
    color: variables.$list-group-action-active-color;
    background-color: variables.$list-group-action-active-bg;
  }
}

// Individual list items
.list-group-item {
  position: relative;
  display: block;
  padding: variables.$list-group-item-padding-y
    variables.$list-group-item-padding-x;
  color: variables.$list-group-color;
  text-decoration: if(variables.$link-decoration == none, null, none);
  background-color: variables.$list-group-bg;
  border: variables.$list-group-border-width solid
    variables.$list-group-border-color;

  &:first-child {
    @include border-radius.border-top-radius(inherit);
  }
  &:last-child {
    @include border-radius.border-bottom-radius(inherit);
  }

  &.disabled,
  &:disabled {
    color: variables.$list-group-disabled-color;
    pointer-events: none;
    background-color: variables.$list-group-disabled-bg;
  }

  &.active {
    z-index: 2;
    color: variables.$list-group-active-color;
    background-color: variables.$list-group-active-bg;
    border-color: variables.$list-group-active-border-color;
  }

  & + & {
    border-top-width: 0;

    &.active {
      margin-top: -(variables.$list-group-border-width);
      border-top-width: variables.$list-group-border-width;
    }
  }
}

// Horizontal list groups
@each $breakpoint in map.keys(variables.$grid-breakpoints) {
  @include breakpoints.media-breakpoint-up($breakpoint) {
    $infix: breakpoints.breakpoint-infix(
      $breakpoint,
      variables.$grid-breakpoints
    );

    .list-group-horizontal#{$infix} {
      flex-direction: row;

      > .list-group-item {
        &:first-child {
          @include border-radius.border-bottom-start-radius(
            variables.$list-group-border-radius
          );
          @include border-radius.border-top-end-radius(0);
        }
        &:last-child {
          @include border-radius.border-top-end-radius(
            variables.$list-group-border-radius
          );
          @include border-radius.border-bottom-start-radius(0);
        }
        &.active {
          margin-top: 0;
        }

        + .list-group-item {
          border-top-width: variables.$list-group-border-width;
          border-left-width: 0;

          &.active {
            margin-left: -(variables.$list-group-border-width);
            border-left-width: variables.$list-group-border-width;
          }
        }
      }
    }
  }
}

// Flush list items
.list-group-flush {
  @include border-radius.border-radius(0);

  > .list-group-item {
    border-width: 0 0 variables.$list-group-border-width;

    &:last-child {
      border-bottom-width: 0;
    }
  }
}

// Contextual variants
@each $state, $value in variables.$theme-colors {
  // Adjust background and text color safely
  $list-group-variant-bg: if(
    meta.type-of($value) == "color",
    color.adjust(
      $value,
      $lightness:
        math.min(100%, math.max(0%, variables.$list-group-item-bg-scale))
    ),
    $value
  );

  $list-group-variant-color: if(
    meta.type-of($value) == "color",
    color.adjust($value, $lightness: variables.$list-group-item-color-scale),
    $value
  );

  // Safe background fallback
  $bg: if(
    meta.type-of($list-group-variant-bg) == "color",
    $list-group-variant-bg,
    #fff
  );

  // Safe contrast fallback
  $contrast-color: if(
    meta.type-of($bg) == "color",
    functions.color-contrast($bg, #000, #fff, variables.$min-contrast-ratio),
    #000
  );

  @if $contrast-color == null {
    $contrast-color: #000;
  }

  // Adjust text color if contrast ratio is too low
  $list-group-variant-color: if(
    functions.contrast-ratio(
        $list-group-variant-bg,
        $list-group-variant-color
      ) <
      variables.$min-contrast-ratio,
    color.mix(
      $value,
      $contrast-color,
      math.abs(variables.$list-group-item-color-scale)
    ),
    $list-group-variant-color
  );

  // Apply variant
  @include list-group.list-group-item-variant(
    $state,
    $list-group-variant-bg,
    $list-group-variant-color
  );
}
