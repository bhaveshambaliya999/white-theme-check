@use "../functions" as functions;
@use "../variables" as variables;
@use "sass:color";
@use "sass:math";
@use "sass:meta";

// Safe wrapper for shift-color
@function safe-shift($c, $amount) {
  @if meta.type-of($c) != "color" {
    @return $c; // fallback
  }
  @return functions.shift-color($c, $amount);
}

// Safe wrapper for opaque()
@function safe-opaque($background, $foreground) {
  @if meta.type-of($foreground) != "color" {
    @return $background;
  }
  @return functions.opaque($background, $foreground);
}

// scss-docs-start table-variant
@mixin table-variant($state, $background) {

  // Protect against non-color background
  @if meta.type-of($background) != "color" {
    $background: variables.$body-bg;
  }

  .table-#{$state} {
    // Compute readable text
    $color: functions.color-contrast(safe-opaque(variables.$body-bg, $background));

    // Safe hover/striped/active shades
    $hover-bg: safe-shift($background, -10%);
    $striped-bg: safe-shift($background, -5%);
    $active-bg: safe-shift($background, -15%);

    // CSS variable output
    --#{variables.$variable-prefix}table-bg: #{$background};
    --#{variables.$variable-prefix}table-striped-bg: #{$striped-bg};
    --#{variables.$variable-prefix}table-striped-color: #{functions.color-contrast($striped-bg)};
    --#{variables.$variable-prefix}table-active-bg: #{$active-bg};
    --#{variables.$variable-prefix}table-active-color: #{functions.color-contrast($active-bg)};
    --#{variables.$variable-prefix}table-hover-bg: #{$hover-bg};
    --#{variables.$variable-prefix}table-hover-color: #{functions.color-contrast($hover-bg)};

    // Base table styles
    color: $color;
    border-color: safe-shift($background, -20%);
  }
}
// scss-docs-end table-variant
